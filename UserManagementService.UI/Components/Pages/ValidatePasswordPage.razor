@page "/validate-password"
@using UserManagementService.Common.DTOs
@using UserManagementService.UI.Services
@inject UserServiceClient UserService
@inject ILogger<ValidatePasswordPage> Logger

<PageTitle>Validate Password</PageTitle>

<h1>Validate Password</h1>

<div class="row">
    <div class="col-md-6">
        <EditForm Model="@model" OnValidSubmit="HandleValidSubmit" FormName="ValidatePasswordForm">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <InputText id="email" class="form-control" @bind-Value="model.Email" />
            </div>

            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <InputText id="password" type="password" class="form-control" @bind-Value="model.Password" />
            </div>

            <button type="submit" class="btn btn-primary">Validate</button>
        </EditForm>

        @if (validationResult != null)
        {
            <div class="mt-3 alert @(isValid ? "alert-success" : "alert-danger")">
                @validationResult
            </div>
        }
    </div>
</div>

@code {
    [SupplyParameterFromForm]
    private ValidatePasswordDto model { get; set; } = new();
    
    private string? validationResult;
    private bool isValid;

    protected override void OnInitialized()
    {
        // Ensure model is initialized if not supplied from form
        model ??= new();
        Logger.LogInformation("ValidatePasswordPage initialized.");
    }

    private async Task HandleValidSubmit()
    {
        Logger.LogInformation("Validating password for user {Email}", model.Email);
        isValid = await UserService.ValidatePasswordAsync(model);
        validationResult = isValid ? "Password is valid." : "Invalid password.";
        Logger.LogInformation("Password validation result: {IsValid}", isValid);
    }
}

